
#include "decoder.hh"

void		check_arg(std::ifstream & myfile)
{
  const char	*sudo = "sudo";
  std::string	line;
  int		cpt;
  int		checkRChariot;
  int		check;

  (void)sudo;
  cpt = 0;
  checkRChariot = 0;
  while (getline(myfile, line))
    {
      check = 0;
      if (line.compare(0, 9, "key press") == 0)
	{
	  std::string num(line, 12, line.size() - 14);
	  for (int i = 0; keys[i].touch; ++i)
	    {
	      if ((num.compare(keys[i].touch)) == 0)
		{
		  if (sudo[cpt] && sudo[cpt] == keys[i].value[0])
		    {
		      ++cpt;
		    }
		  if (cpt == 4 && keys[i].value[0] == '\n')
		    {
		      ++checkRChariot;
		      if (checkRChariot == 2)
		  	{
		  	  cpt = 0;
		  	  checkRChariot = 0;
		  	}
		    }
		  if (cpt == 4 && checkRChariot == 1)
		    {
		      check = 1;
		      std::cout << keys[i].value << " ";
		    }
		  check = 1;
		}
	    }
	  if (cpt == 4 && checkRChariot == 1 && check == 0)
	    std::cout << num << " ";
	}
    }
  std::cout << std::endl;
}

int	main(int ac, char **av)
{
  if (ac == 2)
    {
      std::ifstream myfile;
      myfile.open(av[1]);
      if (myfile.is_open())
	{
	  check_arg(myfile);
	  myfile.close();
	}
      else
	std::cout << "problem file" << std::endl;
    }
  else
    std::cout << "Usage: " << av[0] << " data-file" << std::endl;
  return (0);
}
